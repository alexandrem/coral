<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture - Coral</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">Coral</div>
                <nav class="nav">
                    <a href="index.html">Home</a>
                    <a href="index.html#get-started">Get Started</a>
                    <a href="https://github.com/coral/coral" target="_blank">GitHub</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Architecture Section -->
    <section class="architecture-page">
        <div class="container">
            <div class="section-header">
                <h1>Three-Tier Architecture</h1>
                <p class="section-subtitle">Complete data flow from AI query to live instrumentation</p>
            </div>

            <!-- Detailed Architecture Diagram -->
            <div class="architecture-diagram">
                <div class="mcp-diagram mcp-diagram-detailed">
                    <!-- AI Assistants Layer -->
                    <div class="diagram-layer">
                        <div class="diagram-nodes diagram-nodes-multi">
                            <div class="diagram-node node-clients node-small">
                                <div class="node-icon-small">üñ•Ô∏è</div>
                                <h5>Claude Desktop</h5>
                                <span class="node-tag-small">Anthropic</span>
                            </div>
                            <div class="diagram-node node-clients node-small">
                                <div class="node-icon-small">üíª</div>
                                <h5>VS Code / Cursor</h5>
                                <span class="node-tag-small">OpenAI</span>
                            </div>
                            <div class="diagram-node node-clients node-small">
                                <div class="node-icon-small">‚å®Ô∏è</div>
                                <h5>coral ask</h5>
                                <span class="node-tag-small">Ollama</span>
                            </div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="diagram-arrow">
                        <div class="arrow-line"></div>
                        <div class="arrow-label">MCP Protocol (stdio)</div>
                        <div class="arrow-head">‚ñº</div>
                    </div>

                    <!-- MCP Proxy Layer -->
                    <div class="diagram-layer">
                        <div class="diagram-nodes">
                            <div class="diagram-node node-proxy">
                                <div class="node-icon">üîÑ</div>
                                <h4>coral mcp proxy</h4>
                                <div class="node-detail">Protocol Bridge: MCP ‚Üî gRPC</div>
                            </div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="diagram-arrow">
                        <div class="arrow-line"></div>
                        <div class="arrow-label">Buf Connect gRPC</div>
                        <div class="arrow-head">‚ñº</div>
                    </div>

                    <!-- Colony Layer -->
                    <div class="diagram-layer">
                        <div class="diagram-nodes">
                            <div class="diagram-node node-colony node-detailed">
                                <div class="node-icon">üß†</div>
                                <h4>Colony Server</h4>
                                <ul class="node-features node-features-detailed">
                                    <li><span class="feature-label">MCP Server:</span> Genkit plugin</li>
                                    <li><span class="feature-label">Tools:</span> coral_get_service_health, coral_query_*</li>
                                    <li><span class="feature-label">Security:</span> RBAC & Audit logging</li>
                                    <li><span class="feature-label">Storage:</span> DuckDB with aggregated summaries</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Bidirectional Arrow -->
                    <div class="diagram-arrow-bidirectional">
                        <div class="arrow-up">
                            <div class="arrow-line-up"></div>
                            <div class="arrow-head-up">‚ñ≤</div>
                        </div>
                        <div class="arrow-label-bidirectional">WireGuard Mesh ‚Ä¢ Bidirectional</div>
                        <div class="arrow-down">
                            <div class="arrow-line-down"></div>
                            <div class="arrow-head-down">‚ñº</div>
                        </div>
                    </div>

                    <!-- Agents Layer -->
                    <div class="diagram-layer">
                        <div class="diagram-nodes diagram-nodes-multi">
                            <div class="diagram-node node-agents node-detailed">
                                <div class="node-icon">üëÅÔ∏è</div>
                                <h4>Agent (App A)</h4>
                                <ul class="node-features">
                                    <li>eBPF (Beyla) ‚Ä¢ RED metrics</li>
                                    <li>OTLP Receiver ‚Ä¢ Spans/Logs</li>
                                    <li>DuckDB Local ‚Ä¢ Recent data</li>
                                    <li>Shell/Exec ‚Ä¢ Diagnostics</li>
                                    <li>Live Probes ‚Ä¢ On-demand</li>
                                </ul>
                            </div>
                            <div class="diagram-node node-agents node-detailed">
                                <div class="node-icon">üëÅÔ∏è</div>
                                <h4>Agent (App B)</h4>
                                <ul class="node-features">
                                    <li>eBPF (Beyla) ‚Ä¢ RED metrics</li>
                                    <li>OTLP Receiver ‚Ä¢ Spans/Logs</li>
                                    <li>DuckDB Local ‚Ä¢ Recent data</li>
                                    <li>Shell/Exec ‚Ä¢ Diagnostics</li>
                                    <li>Live Probes ‚Ä¢ On-demand</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="diagram-arrow diagram-arrow-final">
                        <div class="arrow-line"></div>
                        <div class="arrow-label">Monitors</div>
                        <div class="arrow-head">‚ñº</div>
                    </div>

                    <!-- Services Layer -->
                    <div class="diagram-layer">
                        <div class="diagram-nodes diagram-nodes-multi">
                            <div class="diagram-node node-services">
                                <div class="node-icon">‚öôÔ∏è</div>
                                <h5>Your Services</h5>
                            </div>
                            <div class="diagram-node node-services">
                                <div class="node-icon">‚öôÔ∏è</div>
                                <h5>Your Services</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Architecture Components -->
            <div class="arch-components">
                <h2>Architecture Components</h2>
                <div class="arch-grid">
                    <div class="arch-tier">
                        <div class="tier-icon">üß†</div>
                        <h4>Colony</h4>
                        <p>Central coordinator with MCP server, DuckDB storage, and AI orchestration. Provides the unified interface for all AI assistants to query distributed observability data.</p>
                    </div>
                    <div class="arch-tier">
                        <div class="tier-icon">üëÅÔ∏è</div>
                        <h4>Agents</h4>
                        <p>Local observers using eBPF, OTLP, and shell commands to gather telemetry. Run on each service to provide edge-based observability with local DuckDB storage.</p>
                    </div>
                    <div class="arch-tier">
                        <div class="tier-icon">‚öôÔ∏è</div>
                        <h4>SDK (Optional)</h4>
                        <p>Advanced features like live probes and runtime instrumentation. Enables on-demand eBPF uprobes for deep debugging without redeploying.</p>
                    </div>
                </div>
            </div>

            <!-- Key Features -->
            <div class="arch-features">
                <h2>Key Architecture Features</h2>
                <div class="feature-list">
                    <div class="feature-item-large">
                        <h3>üîå Universal MCP Integration</h3>
                        <p>Colony exposes a standard MCP server that works with any AI assistant: Claude Desktop, VS Code, Cursor, or custom applications. The coral mcp proxy translates between MCP protocol (stdio) and Buf Connect gRPC for type-safe communication.</p>
                    </div>
                    <div class="feature-item-large">
                        <h3>üîê Encrypted WireGuard Mesh</h3>
                        <p>All components connect via an encrypted WireGuard mesh that works across any network boundary. No VPN configuration, firewall rules, or per-environment tooling required. Debug apps running on laptop ‚Üî AWS VPC ‚Üî GKE cluster ‚Üî on-prem VM with the same commands.</p>
                    </div>
                    <div class="feature-item-large">
                        <h3>üìä Edge-Based Observability</h3>
                        <p>Agents run on each service with local DuckDB storage for recent data (~1hr rolling window). Colony polls agents for summaries, reducing network overhead while maintaining fast queries for detailed telemetry.</p>
                    </div>
                    <div class="feature-item-large">
                        <h3>üéØ Progressive Integration</h3>
                        <p>Start with Level 0 (zero-config eBPF), optionally add Level 1 (OTLP for OpenTelemetry apps), Level 2 (shell/exec diagnostics), and Level 3 (SDK live probes). Each level adds capability without breaking existing functionality.</p>
                    </div>
                </div>
            </div>

            <!-- Back Link -->
            <div class="back-link">
                <a href="index.html" class="btn btn-secondary">‚Üê Back to Home</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <div class="footer-logo">Coral</div>
                    <p class="footer-tagline">Application Intelligence Mesh</p>
                </div>
                <nav class="footer-nav">
                    <a href="index.html">Home</a>
                    <a href="architecture.html">Architecture</a>
                    <a href="https://github.com/coral/coral">GitHub</a>
                </nav>
                <div class="footer-right">
                    <p>&copy; 2024 Coral</p>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
